# 贵妃直播应用数据库设计

## 概述

这是贵妃直播应用的MySQL数据库设计，包含完整的表结构、初始数据和API服务器。

## 数据库特性

- **数据库类型**: MySQL 8.0+
- **字符集**: utf8mb4
- **排序规则**: utf8mb4_unicode_ci
- **用户ID**: 12位字母数字组合的UUID
- **支持用户类型**: 普通用户、主播、客服、管理员

## 快速开始

### 1. 环境准备

确保已安装：
- Node.js (>= 14.0.0)
- MySQL (>= 8.0)
- npm (>= 6.0.0)

### 2. 安装依赖

```bash
npm install
```

### 3. 配置数据库

复制环境配置文件：
```bash
cp .env.example .env
```

编辑 `.env` 文件，配置你的MySQL连接信息：
```env
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=你的MySQL密码
DB_NAME=guifei_live
```

### 4. 初始化数据库

```bash
npm run init-db
```

这将会：
- 创建 `guifei_live` 数据库
- 创建所有必要的表结构
- 插入初始测试数据
- 创建必要的索引

### 5. 启动API服务器

```bash
# 生产环境
npm start

# 开发环境（自动重启）
npm run dev
```

服务器将在 `http://localhost:3000` 启动。

## 数据库表结构

### 核心表

1. **users** - 核心用户表
2. **users_consumer** - 消费者扩展表
3. **users_live** - 主播扩展表
4. **users_kefu** - 客服扩展表
5. **users_admin** - 管理员扩展表

### 内容表

6. **videos** - 视频内容表
7. **live_rooms** - 直播间表
8. **messages** - 消息/聊天表

### 系统表

9. **categories** - 分类表
10. **games** - 游戏表
11. **gift_types** - 礼物类型表
12. **configs** - 配置表
13. **files** - 文件表

## 初始数据

### 测试账号

| 用户类型 | 用户名 | 手机号 | 密码 | 昵称 |
|---------|--------|--------|------|------|
| 管理员 | admin01 | 13800000000 | 123456 | 管理员 |
| 普通用户 | user01 | 13800000001 | 123456 | 用户 |
| 主播 | live01 | 13800000002 | 123456 | 主播 |
| 客服 | kefu01 | 13800000003 | 123456 | 客服 |

### 游戏数据

- 一分快三
- 时时彩

### 礼物数据

- 小心心 (1元)
- 墨镜 (10元)
- 豪华游轮 (400元)
- Kitty城堡 (1000元)

## API接口

### 用户相关

- `POST /api/login` - 用户登录
- `POST /api/register` - 用户注册
- `GET /api/user/:id` - 获取用户信息

### 内容相关

- `GET /api/games` - 获取游戏列表
- `GET /api/gifts` - 获取礼物列表
- `GET /api/live-rooms` - 获取直播间列表

### 系统相关

- `GET /health` - 健康检查

## 消费等级规则

| 充值金额 | 等级 | 权限 |
|----------|------|------|
| 0元 | 1级 | 不可在直播间评论 |
| 100元+ | 2级 | 可在直播间评论 |
| 200元+ | 3级 | 可在直播间评论 |
| 500元+ | 4级 | 可在直播间评论 |
| 1000元+ | 5级 | 可在直播间评论 |
| 1500元+ | 6级 | 可在直播间评论 |
| 2000元+ | 7级 | 可在直播间评论 |
| 每增加500元 | +1级 | 可在直播间评论 |
| 20级+ | 20级+ | 可在直播间连麦 |

## 游戏规则

### 一分快三

**开奖频率**: 每2分钟一期，全天720期
**期号格式**: yyyyMMdd + 期数 (如: 20250726001)

**玩法类型**:

1. **大小单双** - 投注点数总和的大小/单双 (赔率: 1.95倍)
2. **猜和值区间** - 选择点数总和区间 (赔率: 3.5倍)
   - 小(3-6)、中(7-10)、中(11-14)、大(15-18)
3. **猜豹子** - 猜三个点数是否全相同 (豹子20倍，非豹子1.05倍)
4. **猜点数之和** - 直接猜3个骰子的和 (赔率: 9.5-180倍浮动)

### 时时彩

规则与一分快三相同。

## 注意事项

1. **安全性**: 生产环境请修改默认密码和JWT密钥
2. **性能**: 建议为高频查询字段添加索引
3. **备份**: 定期备份数据库
4. **监控**: 建议添加数据库连接池监控

## 文件结构

```
database/
├── .env.example          # 环境配置示例
├── .env                  # 环境配置（需要创建）
├── README.md             # 说明文档
├── package.json          # Node.js依赖配置
├── package-lock.json     # 依赖锁定文件
├── schema.sql            # 数据库结构和初始数据
├── init_database.js      # 数据库初始化脚本
└── api_server.js         # API服务器
```

## 技术栈

- **数据库**: MySQL 8.0+
- **后端**: Node.js + Express
- **ORM**: mysql2
- **认证**: JWT (预留)
- **加密**: bcrypt (预留)
- **环境配置**: dotenv

## 开发建议

1. 使用连接池管理数据库连接
2. 实现适当的错误处理和日志记录
3. 添加输入验证和SQL注入防护
4. 实现API限流和认证机制
5. 考虑添加Redis缓存层

## 许可证

MIT License